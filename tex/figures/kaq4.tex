\def\MonthTickLabels{2024-01,2024-02,2024-03,2024-04,2024-05,2024-06,2024-07,2024-08,2024-09,2024-10,2024-11,2024-12,2025-01,2025-02,2025-03,2025-04,2025-05,2025-06,2025-07,2025-08,2025-09,2025-10,2025-11,2025-12}

\pgfplotstableread[col sep=comma]{../../results/kaq4.csv}\kaqfourdata

\begin{figure}[H]
\centering
\begin{tikzpicture}
\begin{axis}[
    width=\textwidth,
    height=8cm,
    xmin=-0.5,
    xmax=23.5,
    xtick={0,...,23},
    xticklabels={\MonthTickLabels},
    xticklabel style={rotate=45, anchor=east},
    ymin=1000,
    ylabel={Avg. session duration (s)},
    legend style={at={(0.02,0.98)}, anchor=north west, cells={anchor=west}},
    grid=both,
    major grid style={gray!30},
    minor grid style={gray!15},
]
    \addplot+[mark=*, thick, color=blue]
        table[
            x expr=\coordindex,
            y=avg_session_duration_sec,
            row predicate/.code={
                \pgfplotstablegetelem{\pgfplotstablerow}{year}\of{\kaqfourdata}
                \edef\yearval{\pgfplotsretval}
                \pgfplotstablegetelem{\pgfplotstablerow}{month}\of{\kaqfourdata}
                \edef\monthval{\pgfplotsretval}
                \pgfplotstablegetelem{\pgfplotstablerow}{platform}\of{\kaqfourdata}
                \edef\plat{\pgfplotsretval}
                \ifnum\pdfstrcmp{\yearval}{NULL}=0
                    \pgfplotstableuserowfalse
                \else
                    \ifnum\pdfstrcmp{\monthval}{NULL}=0
                        \pgfplotstableuserowfalse
                    \else
                        \ifnum\pdfstrcmp{\plat}{desktop}=0
                        \else
                            \pgfplotstableuserowfalse
                        \fi
                    \fi
                \fi
            }
        ] {\kaqfourdata};
    \addlegendentry{Desktop}

    \addplot+[mark=square*, thick, color=green!60!black]
        table[
            x expr=\coordindex,
            y=avg_session_duration_sec,
            row predicate/.code={
                \pgfplotstablegetelem{\pgfplotstablerow}{year}\of{\kaqfourdata}
                \edef\yearval{\pgfplotsretval}
                \pgfplotstablegetelem{\pgfplotstablerow}{month}\of{\kaqfourdata}
                \edef\monthval{\pgfplotsretval}
                \pgfplotstablegetelem{\pgfplotstablerow}{platform}\of{\kaqfourdata}
                \edef\plat{\pgfplotsretval}
                \ifnum\pdfstrcmp{\yearval}{NULL}=0
                    \pgfplotstableuserowfalse
                \else
                    \ifnum\pdfstrcmp{\monthval}{NULL}=0
                        \pgfplotstableuserowfalse
                    \else
                        \ifnum\pdfstrcmp{\plat}{mobile}=0
                        \else
                            \pgfplotstableuserowfalse
                        \fi
                    \fi
                \fi
            }
        ] {\kaqfourdata};
    \addlegendentry{Mobile}

    \addplot+[mark=triangle*, thick, color=orange!80!black]
        table[
            x expr=\coordindex,
            y=avg_session_duration_sec,
            row predicate/.code={
                \pgfplotstablegetelem{\pgfplotstablerow}{year}\of{\kaqfourdata}
                \edef\yearval{\pgfplotsretval}
                \pgfplotstablegetelem{\pgfplotstablerow}{month}\of{\kaqfourdata}
                \edef\monthval{\pgfplotsretval}
                \pgfplotstablegetelem{\pgfplotstablerow}{platform}\of{\kaqfourdata}
                \edef\plat{\pgfplotsretval}
                \ifnum\pdfstrcmp{\yearval}{NULL}=0
                    \pgfplotstableuserowfalse
                \else
                    \ifnum\pdfstrcmp{\monthval}{NULL}=0
                        \pgfplotstableuserowfalse
                    \else
                        \ifnum\pdfstrcmp{\plat}{web}=0
                        \else
                            \pgfplotstableuserowfalse
                        \fi
                    \fi
                \fi
            }
        ] {\kaqfourdata};
    \addlegendentry{Web}
\end{axis}
\end{tikzpicture}
\caption{Average session duration by platform and month (kaq4).}
\label{fig:kaq4}
\end{figure}

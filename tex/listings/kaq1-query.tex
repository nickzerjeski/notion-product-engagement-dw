\begin{lstlisting}[language=SQL,caption={Query for answering: How does user engagement evolve over time across subsciption tiers?},label={lst:kaq1},captionpos=b]
SELECT t.year, t.month, u.subscription_tier,
  SUM(f.active_user_flag) AS dau,
FROM fact_product_usage_engagement f
JOIN dim_time t ON t.time_key = f.time_key
JOIN dim_user u ON u.user_key = f.user_key
GROUP BY GROUPING SETS (
  (t.year, t.month, u.subscription_tier),
  (t.year, t.month),
  (u.subscription_tier),
  ()
)
ORDER BY t.year NULLS LAST, t.month NULLS LAST,
                u.subscription_tier NULLS LAST;
\end{lstlisting}
